var Imgr=function(t,e){var n=document.querySelector(t),i="undefined"==typeof e?{}:e,a=function(t,e){return t?t:e},d=a(i.size,{width:100,height:100}),o=a(i.ratio,1),s=a(i.quality,1),l=a(i.callback,function(){}),c=0,r=0,u=0,h=0,p=0,f=function(t){var e=document.createElement(t.tag);return t["class"]&&(e.className=t["class"]),t.id&&(e.id=t.id),e},g=function(t){var e=t.offsetTop,n=t.offsetLeft,i=t.clientWidth,a=t.clientHeight,d=t.parentNode.clientWidth,o=t.parentNode.clientHeight,s=o-a,l=d-i;d>i?t.style.left=d/2-i/2+"px":(l>n&&(t.style.left=l+"px"),n>0&&(t.style.left=0)),o>a?t.style.top=o/2-a/2+"px":(s>e&&(t.style.top=s+"px"),e>0&&(t.style.top=0))},m=function(t){var e=t.querySelector("img"),n={s:function(t){t.touches&&(t=t.touches[0]),r=e.offsetLeft,u=e.offsetTop,h=t.clientX,p=t.clientY,c=1},m:function(t){t.touches&&(t=t.touches[0]),c&&(e.style.left=r+(t.clientX-h)+"px",e.style.top=u+(t.clientY-p)+"px",g(e))},n:function(t){c=0,r=e.offsetLeft,u=e.offsetTop}},i=d.width*o,a=d.height*o;t.parentNode.style.cssText="width:"+(i+60)+"px;height:"+(a+60)+"px",t.style.cssText="width:"+i+"px;height:"+a+"px",e.style.cssText="top:"+(t.clientHeight/2-e.height/2)+"px;left:"+(t.clientWidth/2-e.width/2)+"px",t.addEventListener("mousedown",n.s),window.addEventListener("mousemove",n.m),window.addEventListener("mouseup",n.n),t.addEventListener("touchstart",n.s),window.addEventListener("touchmove",n.m),window.addEventListener("touchend",n.n)},v=function(t,e,n){var i=null,a=null,d={s:function(){return null===i&&(i=setTimeout(function(){a=setInterval(function(){n?e.style.width=e.width+1+"px":e.style.width=e.width-1+"px",e.style.height="auto",g(e)},1)},0)),!1},n:function(){clearTimeout(i),i=null,clearInterval(a),a=null}};t.addEventListener("mousedown",d.s),t.addEventListener("mouseup",d.n),t.addEventListener("mouseout",d.n),t.addEventListener("touchstart",d.s),t.addEventListener("touchend",d.n),t.addEventListener("touchleave",d.n),t.addEventListener("touchcancel",d.n)},w=function(t,e,n){t.addEventListener("click",function(){n?(e.style.width=e.parentNode.clientWidth+"px",e.style.height="auto"):(e.style.width="auto",e.style.height=e.parentNode.clientHeight+"px"),g(e)})},y=function(){document.body.removeChild(document.getElementsByClassName("imgr-container")[0]),n.value=""},L=function(t,e){t.addEventListener("click",function(){var t,n,i,a,d=e.parentNode,c=d.clientWidth/o,r=d.clientHeight/o,u=e.offsetTop/o,h=e.offsetLeft/o,p=e.clientWidth/o,f=e.clientHeight/o,g=e.naturalWidth,m=e.naturalHeight;p>c?(n=Math.abs(h),i=c):(n=0,i=c-2*h),f>r?(t=Math.abs(u),a=r):(t=0,a=r-2*u);var v=document.createElement("canvas");v.width=i,v.height=a;var w=v.getContext("2d"),L=(w.drawImage(e,n/p*g,t/f*m,i/p*g,a/f*m,0,0,i,a),new Image);L.src=v.toDataURL("image/jpeg",s),L.onload=function(){y(),l(L)}})},x=function(t){var e=f({tag:"div","class":"imgr-container"}),n=f({tag:"div","class":"imgr-wrap"}),i=f({tag:"div","class":"imgr-image"}),a=f({tag:"div","class":"imgr-offset"}),d=f({tag:"div","class":"imgr-cancel"}),o=f({tag:"div","class":"imgr-vertical"}),s=f({tag:"div","class":"imgr-horizontal"}),l=f({tag:"div","class":"imgr-zoomin"}),c=f({tag:"div","class":"imgr-zoomout"}),r=f({tag:"div","class":"imgr-crop"});a.appendChild(t),i.appendChild(a),n.appendChild(i),n.appendChild(d),n.appendChild(o),n.appendChild(s),n.appendChild(c),n.appendChild(l),n.appendChild(r),e.appendChild(n),document.body.insertBefore(e,document.body.firstChild),d.onclick=y,w(s,t,!0),w(o,t,!1),v(l,t,!0),v(c,t,!1),m(a),L(r,t)};n.onchange=function(t){var e=new FileReader;e.onload=function(t){var n=new Image;n.src=e.result,n.onload=function(t){x(n)}},e.readAsDataURL(t.target.files[0])}};
